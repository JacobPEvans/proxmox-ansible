---
# Group variables for Proxmox VE servers

# ZFS Swap Configuration
zfs_swap_size: "96G"
zfs_swap_pool: "rpool"
zfs_swap_dataset: "swap"

# Kernel Tuning - Sysctl
kernel_tuning_swappiness: 10
kernel_tuning_vfs_cache_pressure: 50
kernel_tuning_dirty_ratio: 10
kernel_tuning_dirty_background_ratio: 5
kernel_tuning_overcommit_memory: 0

# Kernel Tuning - Boot Parameters (AMD Zen1 stability)
# NOTE: This role manages boot params via /etc/kernel/cmdline (UEFI) or GRUB (BIOS).
# The crash_diagnostics role ALSO manages GRUB params - they will be merged, not conflict.
# For UEFI systems, only kernel_tuning manages /etc/kernel/cmdline.
kernel_tuning_boot_params_enabled: true
kernel_tuning_clocksource: hpet
kernel_tuning_tsc_mode: unstable
kernel_tuning_disable_smt: false
kernel_tuning_disable_deep_cstates: true

# Ulimits Configuration
ulimits_nofile: 65536
ulimits_nproc: 65536
ulimits_users:
  - "*"
  - root
  - splunk

# LXC Container Features
# Docker-in-LXC containers require nesting, keyctl, and fuse for fuse-overlayfs storage driver.
# The BPG Proxmox Terraform provider cannot set features on privileged containers (requires root@pam).
# This role applies the correct feature flags via pct set on the Proxmox host.
lxc_features_containers:
  "110": "nesting=1,keyctl=1,fuse=1"   # mailpit - Docker SMTP relay
  "111": "nesting=1,keyctl=1,fuse=1"   # ntfy - Docker push notifications
  "130": "nesting=1,keyctl=1,fuse=1"   # mssql - Docker MS SQL Server

# Common packages to install
common_packages:
  - htop
  - iotop
  - lm-sensors
  - rasdaemon
